<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Safety Call Japan</title>
    <style>
        :root {
            --primary: #6366f1;
            --success: #10b981;
            --error: #ef4444;
            --bg: #0f172a;
            --card: #1e293b;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: white;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            background: var(--card);
            border-radius: 30px;
            padding: 40px 25px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .shield-icon {
            font-size: 80px;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px var(--primary));
        }

        h1 { margin: 10px 0; font-size: 24px; }
        p { color: #94a3b8; font-size: 14px; line-height: 1.6; }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 15px;
            width: 100%;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            margin-top: 25px;
            transition: 0.3s;
        }

        .btn:active { transform: scale(0.96); opacity: 0.9; }

        .btn-retry { background: var(--error); }

        #activeView { display: none; }
        .success-text { color: var(--success); font-weight: bold; font-size: 18px; margin-top: 15px; }

        .debug-console {
            background: #000;
            color: #4ade80;
            font-family: monospace;
            font-size: 10px;
            padding: 10px;
            border-radius: 10px;
            margin-top: 20px;
            width: 100%;
            max-width: 350px;
            height: 80px;
            overflow-y: auto;
            text-align: left;
            border: 1px solid #334155;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="setupView">
            <div class="shield-icon">ğŸ›¡ï¸</div>
            <h1>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</h1>
            <p>Ù„Ø­Ø¸Ø± Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© (+81) ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù†Ø­ØªØ§Ø¬ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù‡Ø§ØªÙ ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ.</p>
            <button class="btn" id="mainBtn" onclick="startActivation()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¢Ù†</button>
        </div>

        <div id="activeView">
            <div class="shield-icon" style="filter: drop-shadow(0 0 20px var(--success));">âœ…</div>
            <div class="success-text">Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµØ§Ù…ØªØ© Ù†Ø´Ø·Ø©</div>
            <p>ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</p>
            <button class="btn" style="background: #334155;" onclick="localStorage.clear(); location.reload();">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·</button>
        </div>
    </div>

    <div class="debug-console" id="logBox">
        [Ù†Ø¸Ø§Ù…] ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©...<br>
    </div>

    <script src="cordova.js"></script>
    <script>
        const logs = document.getElementById('logBox');
        const mainBtn = document.getElementById('mainBtn');

        function addLog(msg) {
            logs.innerHTML += `> ${msg}<br>`;
            logs.scrollTop = logs.scrollHeight;
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function startActivation() {
            addLog("Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø·Ù„Ø¨...");
            if (window.cordova && cordova.plugins.permissions) {
                requestPermissions();
            } else {
                addLog("Ø®Ø·Ø£: Cordova ØºÙŠØ± Ù…ØªØ§Ø­. Ù‡Ù„ Ø£Ù†Øª Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙØŸ");
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                if(!window.cordova) simulateSuccess();
            }
        }

        // 1. Ø·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        function requestPermissions() {
            const perms = cordova.plugins.permissions;
            const list = [
                perms.READ_PHONE_STATE,
                perms.ANSWER_PHONE_CALLS,
                perms.READ_CALL_LOG
            ];

            addLog("Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯...");
            perms.requestPermissions(list, (status) => {
                if (status.hasPermission) {
                    addLog("ØªÙ… Ù…Ù†Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­.");
                    openDefaultSettings();
                } else {
                    addLog("Ø®Ø·Ø£: ØªÙ… Ø±ÙØ¶ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª âŒ");
                    mainBtn.innerText = "Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª";
                    mainBtn.classList.add('btn-retry');
                }
            }, (err) => {
                addLog("ÙØ´Ù„ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: " + err);
            });
        }

        // 2. ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        function openDefaultSettings() {
            addLog("ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©...");
            if (window.cordova && cordova.plugins.settings) {
                cordova.plugins.settings.open("manage_default_apps", () => {
                    addLog("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Safety Call Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Caller ID.");
                    saveAndFinish();
                }, (err) => {
                    addLog("ÙØ´Ù„ ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.");
                    saveAndFinish();
                });
            } else {
                saveAndFinish();
            }
        }

        function saveAndFinish() {
            localStorage.setItem('silent_guard_active', 'true');
            showActiveUI();
        }

        function showActiveUI() {
            document.getElementById('setupView').style.display = 'none';
            document.getElementById('activeView').style.display = 'block';
            addLog("Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ÙØ¹Ù„ ÙˆÙ…Ø³ØªÙ‚Ø±.");
        }

        function simulateSuccess() {
            addLog("Ø¨ÙŠØ¦Ø© Ø§Ø®ØªØ¨Ø§Ø±: Ù…Ø­Ø§ÙƒØ§Ø© ØªÙØ¹ÙŠÙ„...");
            setTimeout(saveAndFinish, 1000);
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
        document.addEventListener('deviceready', () => {
            addLog("Ù†Ø¸Ø§Ù… ÙƒÙˆØ±Ø¯ÙˆÙØ§ Ø¬Ø§Ù‡Ø².");
            if (localStorage.getItem('silent_guard_active') === 'true') {
                showActiveUI();
            } else {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„
                startActivation();
            }
        }, false);
    </script>
</body>
</html>

