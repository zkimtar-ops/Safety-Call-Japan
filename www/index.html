<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Safety Call Japan</title>
    <style>
        :root { --primary: #6366f1; --success: #10b981; --bg: #0f172a; --card: #1e293b; }
        body { font-family: system-ui, sans-serif; background: var(--bg); color: white; margin: 0; padding: 20px; text-align: center; }
        
        .status-container {
            background: var(--card); border-radius: 30px; padding: 40px 20px;
            margin-top: 50px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .icon-shield {
            font-size: 60px; margin-bottom: 20px;
            filter: drop-shadow(0 0 15px var(--primary));
        }

        .btn-activate {
            background: var(--primary); color: white; border: none;
            padding: 18px 30px; border-radius: 15px; width: 100%;
            font-weight: bold; font-size: 16px; cursor: pointer;
            margin-top: 20px;
        }

        .status-badge {
            display: inline-block; padding: 5px 15px; border-radius: 20px;
            font-size: 12px; margin-bottom: 10px; background: rgba(255,255,255,0.1);
        }

        .permission-item {
            text-align: right; font-size: 13px; color: #94a3b8;
            background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px;
            margin-top: 10px; display: flex; align-items: center; gap: 10px;
        }
    </style>
</head>
<body>

    <div class="status-container">
        <div class="status-badge" id="permStatus">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª...</div>
        <div class="icon-shield">ğŸ›¡ï¸</div>
        <h1 style="margin: 0;">Ø­Ø§Ø±Ø³ Ø§Ù„ÙŠØ§Ø¨Ø§Ù†</h1>
        <p style="color: #94a3b8; font-size: 14px;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¸Ø± Ø§Ù„ØµØ§Ù…Øª Ù„Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</p>

        <div id="setupView">
            <div class="permission-item">
                <span>âœ…</span> <span>Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù‡Ø§ØªÙ (Ù„Ø±ØµØ¯ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª)</span>
            </div>
            <div class="permission-item">
                <span>âœ…</span> <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª (Ù„Ø­Ø¸Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©)</span>
            </div>
            
            <button class="btn-activate" onclick="requestAllPermissions()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</button>
            <p style="font-size: 11px; color: #64748b; margin-top: 15px;">
                * Ø³ÙŠØ·Ù„Ø¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„ÙŠÙ‡Ø§ Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„Ø­Ø¸Ø±.
            </p>
        </div>

        <div id="activeView" style="display: none; color: var(--success); font-weight: bold; padding: 20px;">
            âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨ØµÙ…Øª
            <p style="font-size: 12px; color: #94a3b8; font-weight: normal;">
                ÙŠØªÙ… Ø­Ø¸Ø± Ø£ÙŠ Ù…ÙƒØ§Ù„Ù…Ø© ØºÙŠØ± ÙŠØ§Ø¨Ø§Ù†ÙŠØ© (+81) ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
            </p>
        </div>
    </div>

    <script src="cordova.js"></script>
    <script>
        // Ø¯Ø§Ù„Ø© Ù„Ø·Ù„Ø¨ ÙƒØ§ÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙÙˆØ± ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function requestAllPermissions() {
            if (window.cordova && cordova.plugins.permissions) {
                const permissions = cordova.plugins.permissions;
                const list = [
                    permissions.READ_PHONE_STATE,
                    permissions.ANSWER_PHONE_CALLS,
                    permissions.READ_CALL_LOG
                ];

                permissions.requestPermissions(list, (status) => {
                    if (status.hasPermission) {
                        console.log("ØªÙ… Ù…Ù†Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª");
                        // Ø¨Ø¹Ø¯ Ù…Ù†Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§ØªØŒ Ù†Ø·Ù„Ø¨ ØªØ¹ÙŠÙŠÙ†Ù‡ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
                        openDefaultAppsSettings();
                    } else {
                        console.warn("ØªÙ… Ø±ÙØ¶ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª");
                    }
                }, (err) => console.error(err));
            } else {
                // Ù„Ù„Ù…ØªØµÙØ­ Ø£Ùˆ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                openDefaultAppsSettings();
            }
        }

        function openDefaultAppsSettings() {
            if (window.cordova && cordova.plugins.settings) {
                localStorage.setItem('guard_ready', 'true');
                cordova.plugins.settings.open("manage_default_apps", () => {
                    checkStatus();
                }, () => {
                    alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Caller ID & Spam");
                });
            } else {
                localStorage.setItem('guard_ready', 'true');
                checkStatus();
            }
        }

        function checkStatus() {
            if (localStorage.getItem('guard_ready') === 'true') {
                document.getElementById('setupView').style.display = 'none';
                document.getElementById('activeView').style.display = 'block';
                document.getElementById('permStatus').innerText = "Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…ÙØ¹Ù„Ø©";
                document.getElementById('permStatus').style.color = "#10b981";
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙˆØ± Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø¬Ù‡Ø§Ø²
        document.addEventListener('deviceready', () => {
            checkStatus();
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ÙØªØ­
            if (localStorage.getItem('guard_ready') !== 'true') {
                requestAllPermissions();
            }
        }, false);

        document.addEventListener('resume', checkStatus, false);
    </script>
</body>
</html>

