<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>درع اليابان - الحظر المسبق</title>
    <style>
        :root {
            --primary: #6366f1;
            --success: #10b981;
            --danger: #ef4444;
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.9);
        }

        body {
            font-family: system-ui, sans-serif;
            background: var(--bg); color: white; margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .card {
            background: var(--card); border-radius: 25px; padding: 30px;
            width: 100%; max-width: 400px; text-align: center;
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }

        .shield-icon {
            width: 100px; height: 100px; margin: 0 auto 20px;
            background: #1e293b; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 4px solid var(--primary); transition: 0.5s;
        }

        .shield-icon.active {
            background: var(--success); border-color: #fff;
            box-shadow: 0 0 30px var(--success);
        }

        .btn-main {
            background: var(--primary); color: white; border: none;
            padding: 18px 30px; border-radius: 15px; width: 100%;
            font-weight: bold; font-size: 18px; cursor: pointer; margin-top: 20px;
        }

        .instruction-box {
            background: rgba(255,255,255,0.05); border-radius: 15px;
            padding: 15px; margin-top: 20px; text-align: right; font-size: 14px;
        }

        .log-box {
            background: #000; color: #4ade80; font-family: monospace;
            font-size: 11px; padding: 10px; border-radius: 10px;
            margin-top: 20px; width: 100%; height: 80px; overflow-y: auto; text-align: left;
        }
    </style>
</head>
<body>

    <div class="card">
        <div id="shield" class="shield-icon">
            <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
        </div>
        
        <h1 style="margin: 0; font-size: 22px;">تفعيل الحظر المسبق</h1>
        <p style="color: #94a3b8; font-size: 14px;">لمنع الرنين من الأرقام الدولية تماماً</p>

        <div class="instruction-box">
            <b>الخطوات المطلوبة:</b>
            <ol style="padding-right: 20px; margin: 10px 0;">
                <li>اضغط على الزر أدناه.</li>
                <li>اختر "Safety Call Japan" كتطبيق افتراضي.</li>
                <li>سيتم حظر أي رقم غير ياباني بصمت.</li>
            </ol>
        </div>

        <button class="btn-main" onclick="requestCallScreeningRole()">تشغيل الدرع الآن</button>
    </div>

    <div class="log-box" id="logs">
        [نظام] بانتظار التفعيل...<br>
    </div>

    <script src="cordova.js"></script>
    <script>
        function addLog(m) {
            const l = document.getElementById('logs');
            l.innerHTML += `> ${m}<br>`;
            l.scrollTop = l.scrollHeight;
        }

        function requestCallScreeningRole() {
            addLog("بدء طلب دور 'فحص المكالمات'...");

            if (!window.cordova) {
                addLog("خطأ: يجب تشغيل التطبيق على هاتف أندرويد.");
                return;
            }

            // لفتح شاشة اختيار التطبيق الافتراضي (Role Manager)
            // نستخدم إضافة cordova-plugin-intent أو نفتح الإعدادات العامة
            if (window.plugins && window.plugins.intentShim) {
                addLog("محاولة فتح شاشة Role Manager...");
                window.plugins.intentShim.startActivity({
                    action: "android.settings.MANAGE_DEFAULT_APPS_SETTINGS"
                }, () => {}, () => {});
            } else {
                addLog("يرجى الذهاب إلى: الإعدادات > التطبيقات > التطبيقات الافتراضية > تطبيق تعريف المتصل.");
                // كحل أخير نفتح إعدادات التطبيق نفسه
                if(cordova.plugins.settings) cordova.plugins.settings.open("application_details");
            }

            // تحديث الواجهة برمجياً بعد الضغط
            document.getElementById('shield').classList.add('active');
            localStorage.setItem('protection_enabled', 'true');
        }

        document.addEventListener('deviceready', () => {
            addLog("النظام جاهز.");
            if(localStorage.getItem('protection_enabled') === 'true') {
                document.getElementById('shield').classList.add('active');
            }
        }, false);
    </script>
</body>
</html>

