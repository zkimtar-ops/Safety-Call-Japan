<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Ø¯Ø±Ø¹ Ø§Ù„ÙŠØ§Ø¨Ø§Ù† - Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</title>
    <style>
        :root {
            --primary: #4f46e5;
            --success: #10b981;
            --bg: #0f172a;
            --card: #1e293b;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg); color: white; margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .card {
            background: var(--card); border-radius: 30px; padding: 30px;
            width: 100%; max-width: 400px; text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .status-icon {
            font-size: 60px; margin-bottom: 20px;
            display: inline-block; transition: 0.5s;
        }

        .active-icon { transform: scale(1.2); filter: drop-shadow(0 0 15px var(--success)); }

        .btn-main {
            background: var(--primary); color: white; border: none;
            padding: 20px; border-radius: 18px; width: 100%;
            font-weight: bold; font-size: 18px; cursor: pointer;
            margin-top: 25px; transition: 0.3s;
        }

        .btn-main:active { transform: scale(0.95); background: #4338ca; }

        .log-box {
            background: #000; color: #4ade80; font-family: monospace;
            font-size: 11px; padding: 12px; border-radius: 12px;
            margin-top: 20px; width: 100%; height: 100px; overflow-y: auto; text-align: left;
        }

        .step { font-size: 13px; color: #94a3b8; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <div id="icon" class="status-icon">ğŸ›¡ï¸</div>
        <h1 style="margin: 0;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¸Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h1>
        <p class="step">Ø³ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø·Ù„Ø¨ ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒØ­Ø§Ø±Ø³ Ù„Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</p>

        <button class="btn-main" onclick="triggerDefaultAppRequest()">ØªÙØ¹ÙŠÙ„ ÙƒÙ…ØªØµÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
        
        <p style="font-size: 11px; color: #64748b; margin-top: 15px;">
            Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ø§Ø®ØªØ± "Safety Call Japan" Ø«Ù… "Set as default".
        </p>
    </div>

    <div class="log-box" id="debugLogs">
        [Ù†Ø¸Ø§Ù…] Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„...<br>
    </div>

    <script src="cordova.js"></script>
    <script>
        function writeLog(msg) {
            const logs = document.getElementById('debugLogs');
            logs.innerHTML += `> ${msg}<br>`;
            logs.scrollTop = logs.scrollHeight;
        }

        function triggerDefaultAppRequest() {
            writeLog("Ø¨Ø¯Ø¡ Ø·Ù„Ø¨ ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ...");

            if (typeof cordova === 'undefined') {
                writeLog("Ø®Ø·Ø£: Cordova ØºÙŠØ± Ù…ØªÙˆÙØ±. Ø¬Ø±Ø¨ Ø¹Ù„Ù‰ APK.");
                return;
            }

            // Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ Ø´Ø§Ø´Ø© Role Manager Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± Intent
            if (window.plugins && window.plugins.intentShim) {
                window.plugins.intentShim.startActivity({
                    action: "android.app.role.action.REQUEST_ROLE",
                    extras: {
                        "android.app.role.extra.ROLE_NAME": "android.app.role.CALL_SCREENING"
                    }
                }, 
                () => { writeLog("ØªÙ… ÙØªØ­ Ø·Ù„Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­."); },
                () => { 
                    writeLog("ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±. ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ©...");
                    openManualSettings();
                });
            } else {
                writeLog("Ø¥Ø¶Ø§ÙØ© Intent ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©. ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...");
                openManualSettings();
            }
        }

        function openManualSettings() {
            if (window.cordova && cordova.plugins.settings) {
                cordova.plugins.settings.open("manage_default_apps", () => {
                    writeLog("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Caller ID.");
                }, () => {
                    writeLog("ÙØ´Ù„ ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.");
                });
            }
        }

        document.addEventListener('deviceready', () => {
            writeLog("Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„.");
            // Ø·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
            const permissions = cordova.plugins.permissions;
            permissions.requestPermissions([
                permissions.READ_PHONE_STATE,
                permissions.ANSWER_PHONE_CALLS,
                permissions.READ_CALL_LOG
            ], (s) => writeLog("ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯: " + s.hasPermission), null);
        }, false);
    </script>
</body>
</html>

